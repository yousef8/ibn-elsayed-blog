@plugin '@tailwindcss/typography';

@layer base {
  .prose {
    @apply prose-headings:mb-3! prose-headings:text-heading! prose-h3:italic prose-p:text-foreground! prose-a:text-foreground! prose-a:no-underline prose-blockquote:border-l-accent/50! prose-blockquote:opacity-80 prose-figcaption:text-foreground! prose-figcaption:opacity-70 prose-strong:text-foreground! prose-code:rounded prose-code:bg-muted/75 prose-code:p-1 prose-code:text-foreground! prose-code:before:content-none! prose-code:after:content-none! prose-ol:text-foreground! prose-ul:overflow-x-clip prose-ul:text-foreground! prose-li:marker:text-accent! prose-table:text-foreground prose-th:border prose-th:border-border prose-td:border prose-td:border-border prose-img:mx-auto prose-img:my-2! prose-img:border-2 prose-img:border-border prose-hr:border-border!;
  }

  .prose a {
    @apply wrap-break-word no-underline! relative inline-block transition-colors duration-300 ease-in-out;
  }

  .prose a::after {
    content: "";
    @apply bg-accent absolute bottom-0 left-0 h-0.5 w-full origin-left;
    transform: scaleX(1);
    transition: transform 0.3s ease-in-out;
  }

  .prose a:hover::after,
  .prose a:focus-visible::after {
    animation: underlineBounce 0.6s ease-in-out;
  }

  .prose a:hover {
    @apply text-accent!;
  }

  :is([dir="rtl"]) .prose a::after {
    @apply origin-right;
  }

  @keyframes underlineBounce {
    0% {
      transform: scaleX(1);
    }
    50% {
      transform: scaleX(0);
    }
    100% {
      transform: scaleX(1);
    }
  }

  .prose thead th:first-child,
  tbody td:first-child,
  tfoot td:first-child {
    padding-inline-start: 0.5714286em !important;
  }

  .prose details {
    @apply text-foreground inline-block cursor-pointer select-none;
  }
  .prose summary {
    @apply focus-visible:outline-accent focus-visible:no-underline focus-visible:outline-dashed focus-visible:outline-2 focus-visible:outline-offset-1;
  }

  /* ===== Heading Anchor Links ===== */
  .prose :is(h1, h2, h3, h4, h5, h6) {
    @apply relative;
  }

  .prose .heading-anchor {
    @apply absolute end-full start-auto top-1/2 -translate-y-1/2 opacity-100 transition-opacity duration-200 sm:opacity-0;
  }

  .prose :is(h1, h2, h3, h4, h5, h6):hover .heading-anchor {
    @apply opacity-100;
  }

  .heading-anchor-icon {
    @apply text-accent h-4 w-4 sm:h-5 sm:w-5;
  }

  /* ===== Code Blocks & Syntax Highlighting ===== */
  pre:has(code) {
    @apply border-border bg-muted! border;
  }

  .prose code,
  .prose blockquote {
    @apply wrap-break-word;
  }

  .prose table code {
    /* add line breaks whenever necessary for codes under table */
    @apply break-all sm:break-normal;
  }

  pre > code {
    white-space: pre;
  }

  /* Apply Dark Theme (if multi-theme specified) */
  html[data-theme="dark"] pre:has(code),
  html[data-theme="dark"] pre:has(code) span {
    color: var(--shiki-dark) !important;
    font-style: var(--shiki-dark-font-style) !important;
    font-weight: var(--shiki-dark-font-weight) !important;
    text-decoration: var(--shiki-dark-text-decoration) !important;
  }
}
