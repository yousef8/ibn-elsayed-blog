---
import { getRelativeLocalePath } from "@/i18n/utils";
import { getPath } from "@/utils/getPath";
import { slugifyStr } from "@/utils/slugify";
import { Image } from "astro:assets";
import type { CollectionEntry } from "astro:content";
import Datetime from "./Datetime.astro";

export interface Props extends CollectionEntry<"blog"> {
  variant?: "h2" | "h3";
}

const { variant = "h2", data, id, filePath } = Astro.props;

const { title, description, pubDatetime, modDatetime, timezone, coverImage } =
  data;

const headerProps = {
  style: { viewTransitionName: slugifyStr(title) },
  class: "text-lg font-medium",
};

const currentLocale = Astro.currentLocale;
---

<li class="my-6">
  <a
    href={getRelativeLocalePath(currentLocale, getPath(id, filePath))}
    class="card-container group flex flex-col gap-4 sm:flex-row sm:items-start"
  >
    {
      coverImage && (
        <div class="card-image-wrapper relative shrink-0 overflow-hidden rounded-lg sm:h-32 sm:w-48">
          <Image
            src={coverImage}
            alt="Blog post cover image"
            class="h-full! w-full object-cover transition-transform duration-300 group-hover:scale-105"
            loading="lazy"
            decoding="async"
          />
          <div class="absolute inset-0 flex items-center justify-center bg-background opacity-0 transition-opacity duration-300 group-hover:opacity-60">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="48"
              height="48"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="3.5"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="text-accent brightness-125 saturate-400"
            >
              <path d="m9 18 6-6-6-6" />
            </svg>
          </div>
        </div>
      )
    }
    <div class="flex-1">
      <div class="card-title inline-block text-lg font-medium text-accent">
        {
          variant === "h2" ? (
            <h2 {...headerProps}>{title}</h2>
          ) : (
            <h3 {...headerProps}>{title}</h3>
          )
        }
      </div>
      <Datetime {pubDatetime} {modDatetime} {timezone} />
      <p>{description}</p>
    </div>
  </a>
</li>

<style>
  .card-title {
    position: relative;
    text-decoration: none;
  }

  .card-title::after {
    content: "";
    position: absolute;
    left: 0;
    bottom: 0;
    width: 100%;
    height: 2px;
    background-color: currentColor;
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.3s ease-in-out;
  }

  .card-container:hover .card-title::after,
  .card-container:focus-visible .card-title::after {
    transform: scaleX(1);
    animation: underlineSweep 0.6s ease-in-out forwards;
  }

  @keyframes underlineSweep {
    from {
      transform: scaleX(0);
    }
    to {
      transform: scaleX(1);
    }
  }

  :global([dir="rtl"]) .card-title::after {
    transform-origin: right;
  }
</style>
